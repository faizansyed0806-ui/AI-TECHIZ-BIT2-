<!-- templates/index.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI-Techiz: Health & CV Toolkit</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 200px; }
    .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    .error { color: red; white-space: pre-wrap; }
    pre { background: #f7f7f7; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>AI-Techiz: Health & Computer Vision Toolkit</h1>

  {% if error %}
    <div class="section error">
      <strong>Error:</strong><br>
      {{ error }}<br>
      {% if trace %}
        <pre>{{ trace }}</pre>
      {% endif %}
    </div>
  {% endif %}

  <!-- FACE + SKIN TONE -->
  <div class="section">
    <h2>1) Face Shape & Skin Tone</h2>
    <form action="{{ url_for('analyze_image_route') }}" method="post" enctype="multipart/form-data">
      <label>Upload face image:</label><br>
      <input type="file" name="image" required><br><br>

      <label>Side for skin tone analysis:</label>
      <select name="side">
        <option value="left">Left</option>
        <option value="right">Right</option>
      </select><br><br>

      <label>
        <input type="checkbox" name="visualize" value="1">
        Generate debug image with bounding boxes
      </label><br><br>

      <button type="submit">Analyze</button>
    </form>

    {% if face_result %}
      <h3>Face Shape Result (JSON)</h3>
      <pre>{{ face_result }}</pre>
    {% endif %}

    {% if skin_result %}
      <h3>Skin Tone Result (JSON)</h3>
      <pre>{{ skin_result }}</pre>
    {% endif %}

    {% if debug_img %}
      <h3>Debug Image</h3>
      <img src="{{ debug_img }}" style="max-width:400px;">
    {% endif %}
  </div>

  <!-- TDEE -->
  <div class="section">
    <h2>2) TDEE Calculator</h2>
    <form action="{{ url_for('calculate_tdee_route') }}" method="post">
      Age: <input type="number" name="age" required><br>
      Sex:
      <select name="sex">
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select><br>
      Height (cm): <input type="number" step="0.1" name="height_cm" required><br>
      Weight (kg): <input type="number" step="0.1" name="weight_kg" required><br>
      Activity:
      <select name="activity">
        <option value="sedentary">Sedentary</option>
        <option value="light">Lightly active</option>
        <option value="moderate">Moderately active</option>
        <option value="very_active">Very active</option>
        <option value="extremely_active">Extremely active</option>
      </select><br><br>
      <button type="submit">Calculate TDEE</button>
    </form>

    {% if tdee_value %}
      <p><strong>Your TDEE:</strong> {{ tdee_value }} kcal/day</p>
    {% endif %}
  </div>

  <!-- DIET PLAN -->
  <div class="section">
    <h2>3 Generate 7-Day Diet Plan</h2>
    <form action="{{ url_for('generate_diet_route') }}" method="post">
      TDEE (kcal): <input type="number" name="tdee" value="{{ tdee_value or '' }}" required><br>
      Goal:
      <select name="goal">
        <option value="maintenance">Maintenance</option>
        <option value="weight_loss">Weight Loss</option>
        <option value="muscle_gain">Muscle Gain</option>
      </select><br>
      Exclusions (comma-separated, e.g. vegetarian,dairy_free):<br>
      <input type="text" name="exclusions"><br><br>
      <button type="submit">Generate Plan</button>
    </form>

    {% if diet_plan %}
      <h3>Diet Plan (JSON)</h3>
      <pre>{{ diet_plan }}</pre>
    {% endif %}
  </div>
</body>
</html>
